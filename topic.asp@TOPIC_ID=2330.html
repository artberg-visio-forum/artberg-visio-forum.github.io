<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>
<title>Visio - Обработка графических схем</title>
<meta name="copyright" content="This Forum code is Copyright (C) 2000-09 Michael Anderson, Pierre Gorissen, Huw Reddick and Richard Kinser, Non-Forum Related code is Copyright (C) 2000-02 Snitz Communications">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" >
<style type="text/css">
<!--
a:link    {color:darkblue;text-decoration:underline}
a:visited {color:blue;text-decoration:underline}
a:hover   {color:red;text-decoration:underline}
a:active  {color:red;text-decoration:}
.spnMessageText a:link    {color:darkblue;text-decoration:underline}
.spnMessageText a:visited {color:blue;text-decoration:underline}
.spnMessageText a:hover   {color:red;text-decoration:underline}
.spnMessageText a:active  {color:red;text-decoration:underline}
.spnSearchHighlight {background-color:yellow}
input.radio {background:lightsteelblue;color:#000000}
-->
</style>
</head>

<body bgColor="white" text="midnightblue" link="darkblue" aLink="red" vLink="blue">
<a name="top"></a>

<script>(function() { var cx = '002792228947284598284:fmq7et_yt8s'; var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true; gcse.src = 'https://cse.google.com/cse.js?cx=' + cx; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s); })();</script>
<div style='height: 70px; margin-left:10%; width: 80%; text-align:right;'><div class='gcse-search'></div></div>
<table align="center" border="0" cellPadding="0" cellSpacing="0" width="95%">
  <tr>
    <td>
    
    
      <table border="0" width="100%">
        <tr>
          <td width="50%" align="left" nowrap><font face="Verdana, Arial, Helvetica" size="2">
          <img src="icon_folder_open.gif" width="15" height="15" border="0" alt="" title="" align="absmiddle" />&nbsp;<a href="default.asp.html">All Forums</a><br />
          <img src="icon_bar.gif" width="15" height="15" border="0" alt="" title="" align="absmiddle" /><img src="icon_folder_open.gif" width="15" height="15" border="0" alt="" title="" align="absmiddle" />&nbsp;<a href="default.asp@CAT_ID=2.html">Категория Visio</a><br />
          <img src="icon_blank.gif" width="15" height="15" border="0" alt="" title="" align="absmiddle" /><img src="icon_bar.gif" width="15" height="15" border="0" alt="" title="" align="absmiddle" /><img src="icon_folder_open.gif" width="15" height="15" border="0" alt="" title="" align="absmiddle" />&nbsp;<a href="forum.asp@FORUM_ID=5.html">Для заказчиков</a><br />
          <img src="icon_blank.gif" width="15" height="15" border="0" alt="" title="" align="absmiddle" /><img src="icon_blank.gif" width="15" height="15" border="0" alt="" title="" align="absmiddle" /><img src="icon_bar.gif" width="15" height="15" border="0" alt="" title="" align="absmiddle" /><img src="icon_folder_open_topic.gif" width="15" height="15" border="0" alt="" title="" align="absmiddle" />&nbsp;Обработка графических схем</font></td>
          <td align="center" width="50%">
          <font face="Verdana, Arial, Helvetica" size="2">
          </font></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table align="center" border="0" cellPadding="0" cellSpacing="0" width="95%">
  <tr>
    <td>
      <table border="0" width="100%" cellspacing="0" cellpadding="0" align="center">
        <tr>
          <td bgcolor="black">
            <table border="0" width="100%" cellspacing="1" cellpadding="4">
              <tr>
                <td align="center" bgcolor="midnightblue" width="100" nowrap><b><font face="Verdana, Arial, Helvetica" size="2" color="mintcream">Author</font></b></td>
                <td align="center" bgcolor="midnightblue" width="100"><b><font face="Verdana, Arial, Helvetica" size="2" color="mintcream">
                <a href="topic.asp@TOPIC_ID=2228.html"><img src="icon_go_left.gif" width="15" height="15" border="0" alt="Previous Topic" title="Previous Topic" align="top" hspace="6" /></a><b><font face="Verdana, Arial, Helvetica" size="2" color="mintcream">&nbsp;Topic&nbsp;</font></b><a href="topic.asp@TOPIC_ID=300.html"><img src="icon_go_right.gif" width="15" height="15" border="0" alt="Next Topic" title="Next Topic" align="top" hspace="6" /></a></font></b></td>
                <td align="right" bgcolor="midnightblue" nowrap><font face="Verdana, Arial, Helvetica" size="2">&nbsp;</font></td>
              </tr>
              <tr>
                <td bgcolor="whitesmoke" valign="top" width="100" nowrap>
                <p><font color="midnightblue" face="Verdana, Arial, Helvetica" size="2"><b><span class="spnMessageText">bdfy</span></b></font><br />
                </p>
                <p>
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>Belarus</small></font><br />
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>267 Posts</small></font></p></td>
                <td bgcolor="whitesmoke" width="100%" colspan="2" valign="top">
                  <table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td valign="top">
                      <img src="icon_posticon.gif" width="15" height="15" border="0" alt="" title="" hspace="3" /><font color="midnightblue" face="Verdana, Arial, Helvetica" size="1">Posted&nbsp;-&nbsp;03/29/2010&nbsp;:&nbsp; 16:45:10</font>
                      <hr noshade size="1"></td>
                    </tr>
                    <tr>
                      <td valign="top" height="100%"><font face="Verdana, Arial, Helvetica" size="2" color="midnightblue"><span class="spnMessageText" id="msg"> Есть схема - план цеха с нанесенной сетью освещения. точнее много схем разных. см. рис 10, 20<br /><br />сеть освещения рисуется макросом в принципе и выходит неплохо - но коннекторы от щитка освещения (ЩО, ЩАО на схеме) до светильников визио рисует как попало. а нужно аккуратно по стенам/тросам. <br />помещения определены как специальные смарт шейпы box'ы. <br />тросы - тоже как шейпы. <br />щитки освещения - тоже спец. шейпы. <br /><br />необходимо растащить коннекторы по стенам/тросам с минимальным количеством пересечений. как на рис. 20_0<br />поставить выключатели в помещениях и протянуть к ним проводку. вот тут незадача ибо дверные проемы определены не всегда однозначно. а ставятся они рядом с дверями. <br /><br />пример файлика прилагаю в архиве 10test. там же и все скриншоты. <br /><a href="http://rapidshare.com/files/369588617/___________________.rar.html" target="_blank">http://rapidshare.com/files/369588617/___________________.rar.html</a><br /><br />вот и думаю - реально ли эту работу автоматизировать ? ибо стоит задача либо платить людям за эту тупую механическую работу либо заплатить программисту за универсальное решение...<br /> и я бы предпочел второй вариант. ибо у меня идеи закончились ( <br /></span></font></td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td bgcolor="gainsboro" valign="top" width="100" nowrap>
                <p><font face="Verdana, Arial, Helvetica" size="2"><b><span class="spnMessageText">Tumanov</span></b></font><br />
                </p>
                <p>
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>Russia</small></font><br />
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>1198 Posts</small></font></p></td>
                <td bgcolor="gainsboro" height="100%" width="100%" colspan="2" valign="top"><a name="4412"></a>
                  <table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td valign="top">
                      <img src="icon_posticon.gif" width="15" height="15" border="0" alt="" title="" hspace="3" /><font color="midnightblue" face="Verdana, Arial, Helvetica" size="1">Posted&nbsp;-&nbsp;03/30/2010&nbsp;:&nbsp; 04:50:01</font>
                      <hr noshade size="1"></td>
                    </tr>
                    <tr>
                      <td valign="top" height="100%"><font face="Verdana, Arial, Helvetica" size="2" color="midnightblue"><span class="spnMessageText" id="msg"> 1. А что служит исходными данными для макроса, который сейчас рисует сеть освещения?<br />2. Вообще без ручной работы едва ли получится. Будут, например, случаи, когда дверей две и надо указать, у какой из них выключатель ставить. Логично было бы человеку как-то "мазнуть", наметить путь, а макрос красиво уложил бы все в намеченный след.</span></font></td>
                    </tr>
                    <tr>
                      <td valign="bottom" align="right" height="20"><a href="topic.asp@TOPIC_ID=2330.html#top"><img src="icon_go_up.gif" width="15" height="15" border="0" alt="Go to Top of Page" title="Go to Top of Page" align="right" /></a></td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td bgcolor="whitesmoke" valign="top" width="100" nowrap>
                <p><font face="Verdana, Arial, Helvetica" size="2"><b><span class="spnMessageText">bdfy</span></b></font><br />
                </p>
                <p>
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>Belarus</small></font><br />
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>267 Posts</small></font></p></td>
                <td bgcolor="whitesmoke" height="100%" width="100%" colspan="2" valign="top"><a name="4413"></a>
                  <table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td valign="top">
                      <img src="icon_posticon.gif" width="15" height="15" border="0" alt="" title="" hspace="3" /><font color="midnightblue" face="Verdana, Arial, Helvetica" size="1">Posted&nbsp;-&nbsp;03/30/2010&nbsp;:&nbsp; 22:45:19</font>
                      <hr noshade size="1"></td>
                    </tr>
                    <tr>
                      <td valign="top" height="100%"><font face="Verdana, Arial, Helvetica" size="2" color="midnightblue"><span class="spnMessageText" id="msg"> <blockquote id="quote"><font size="1" face="Verdana, Arial, Helvetica" id="quote">quote:<hr height="1" noshade id="quote">1. А что служит исходными данными для макроса, который сейчас рисует сеть освещения?<hr height="1" noshade id="quote"></font></blockquote><br />схема вручную размечается прямоугольниками задающими границы помещений. щитки ЩО ЩАО выставляются руками. светильники "выход" тоже руками.  <br />потом на основании размеров помещений и ряда других свойств по заданной методике идет расчет и выбор светильников. развешиваются светильники, тянутся связи к одной точке щитка ЩО/ЩАО. потом макрос сортирует присоединения на щитке - но даже здесь алгоритм толковый не выходит - все равно бывает некорректная сортировка. <br /><br /> <blockquote id="quote"><font size="1" face="Verdana, Arial, Helvetica" id="quote">quote:<hr height="1" noshade id="quote">2. Вообще без ручной работы едва ли получится. Будут, например, случаи, когда дверей две и надо указать, у какой из них выключатель ставить. Логично было бы человеку как-то "мазнуть", наметить путь, а макрос красиво уложил бы все в намеченный след.<hr height="1" noshade id="quote"></font></blockquote><br />насчет дверей это просто ) если две - лепить к примеру к любой ) <br />"Логично было бы человеку как-то "мазнуть", наметить путь"<br />вот это совсем неясно. читал вот про path find алгоритмы с учетом "весов" квадратов... в игрушках используется. если считать участки сетки близкие к стене-тросу участками с меньшим весом... может чего и вышло. но реализацию не представляю пока.</span></font></td>
                    </tr>
                    <tr>
                      <td valign="bottom" align="right" height="20"><a href="topic.asp@TOPIC_ID=2330.html#top"><img src="icon_go_up.gif" width="15" height="15" border="0" alt="Go to Top of Page" title="Go to Top of Page" align="right" /></a></td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td bgcolor="gainsboro" valign="top" width="100" nowrap>
                <p><font face="Verdana, Arial, Helvetica" size="2"><b><span class="spnMessageText">Tumanov</span></b></font><br />
                </p>
                <p>
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>Russia</small></font><br />
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>1198 Posts</small></font></p></td>
                <td bgcolor="gainsboro" height="100%" width="100%" colspan="2" valign="top"><a name="4414"></a>
                  <table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td valign="top">
                      <img src="icon_posticon.gif" width="15" height="15" border="0" alt="" title="" hspace="3" /><font color="midnightblue" face="Verdana, Arial, Helvetica" size="1">Posted&nbsp;-&nbsp;03/31/2010&nbsp;:&nbsp; 16:00:14</font>
                      <hr noshade size="1"></td>
                    </tr>
                    <tr>
                      <td valign="top" height="100%"><font face="Verdana, Arial, Helvetica" size="2" color="midnightblue"><span class="spnMessageText" id="msg"> <blockquote id="quote"><font size="1" face="Verdana, Arial, Helvetica" id="quote">quote:<hr height="1" noshade id="quote">"Логично было бы человеку как-то "мазнуть", наметить путь"<br />вот это совсем неясно.<hr height="1" noshade id="quote"></font></blockquote><br />Это я подумал, нельзя ли что-то выжать из перекрытия шейпов...<br />Например, толстой ломаной грубо наносим желательный путь, некий виртуальный кабельный канал. Потом вычисляем стены, тросы, дверные проемы, светильники (выводы), которые он накрыл (или пересек), и имеем информацию, что надо соединять и по рядом с какими шейпами вести соединения. То есть грубо "мазнули", нажали кнопку, получили уложенные провода.<br />Но это пока голая идея, поэкспериментировать надо...</span></font></td>
                    </tr>
                    <tr>
                      <td valign="bottom" align="right" height="20"><a href="topic.asp@TOPIC_ID=2330.html#top"><img src="icon_go_up.gif" width="15" height="15" border="0" alt="Go to Top of Page" title="Go to Top of Page" align="right" /></a></td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td bgcolor="whitesmoke" valign="top" width="100" nowrap>
                <p><font face="Verdana, Arial, Helvetica" size="2"><b><span class="spnMessageText">bdfy</span></b></font><br />
                </p>
                <p>
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>Belarus</small></font><br />
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>267 Posts</small></font></p></td>
                <td bgcolor="whitesmoke" height="100%" width="100%" colspan="2" valign="top"><a name="4415"></a>
                  <table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td valign="top">
                      <img src="icon_posticon.gif" width="15" height="15" border="0" alt="" title="" hspace="3" /><font color="midnightblue" face="Verdana, Arial, Helvetica" size="1">Posted&nbsp;-&nbsp;04/01/2010&nbsp;:&nbsp; 21:43:08</font>
                      <hr noshade size="1"></td>
                    </tr>
                    <tr>
                      <td valign="top" height="100%"><font face="Verdana, Arial, Helvetica" size="2" color="midnightblue"><span class="spnMessageText" id="msg"> вот макрос сортировки который сейчас использую. и тот далек от совершенства ((<br /><pre id="code"><font face="courier" size="2" id="code">Public Function ConnectedShapes(ByVal Sh As Visio.Shape)
Dim Passive() As Visio.Shape
Dim Active() As Visio.Shape

    'Set sh = ActiveWindow.Selection.Item(1) 'выделенный шейп
    'Активные связи 2D-шейпа
    If Sh.Connects.Count &gt; 0 Then 'условие наличия активных связей
    For i = 1 To Sh.Connects.Count 'цикл перебора всех активных связей
    ReDim Preserve Active(i)
    Set Active(i - 1) = Sh.Connects(i).ToSheet 'активные связи (к чему приклеен)
   ' Debug.Print "active " & Active(I - 1).Name
    Next
    End If

    'Пассивные связи 2D-шейпа
    If Sh.FromConnects.Count &gt; 0 Then 'условие наличия пассивных связей
    For i = 1 To Sh.FromConnects.Count 'цикл перебора всех пассивных связей
    ReDim Preserve Passive(i)
    Set Passive(i - 1) = Sh.FromConnects(i).FromSheet 'пассивные связи (какие шейпы приклеены к выделенному)
  '  Debug.Print "passive " & Passive(I - 1).Name
    Next
    End If
    
    ConnectedShapes = Array(Active, Passive)
End Function
Sub сортировать_присоединения()

dx_con = 0
For Each vid In Array("ЩО", "ЩАО")
Set sho = найти_шкаф(vid) 'находим щит освещения на схеме

               ar = ConnectedShapes(sho)
                Active = ar(0)
                Passive = ar(1)
                

Debug.Print "щиток " & shape0 & " " & имеет & UBound(Passive) & " присоедениний"
        Dim svet() As Variant
        Dim y() As Variant
        Dim room() As Variant
        Dim num() As Variant
        Dim dx(), dy(), atan(), qvadr() As Variant
        
        ReDim svet(UBound(Passive)), y(UBound(Passive)), room(UBound(Passive)), num(UBound(Passive)), _
        atan(UBound(Passive)), dx(UBound(Passive)), dy(UBound(Passive)), atan(UBound(Passive)), qvadr(UBound(Passive))
        
        
                      For i = 0 To UBound(Passive) - 1 'Passive присоединения к щитку все пассивные
                      
                      Set svet(i) = ConnectedShapes(Passive(i))(0)(1)
                      y(i) = Round(svet(i).Cells("pinY"), 2)
                      room(i) = Getroom(svet(i))
                      num(i) = i
                      'угол от -180 до 180 найдем
                      dx(i) = svet(i).Cells("pinX") - sho.Cells("pinX")
                      dy(i) = svet(i).Cells("pinY") - sho.Cells("pinY")
                        atan(i) = Round(Atn(dy(i) / dx(i)) * 180 / 3.14, 2) - sho.Cells("angle")
                        If dx(i) &lt; 0 Then
                            If dy(i) &gt;= 0 Then
                            atan(i) = atan(i) + 180
                            ElseIf dy(i) &lt; 0 Then
                            atan(i) = atan(i) - 180
                            End If
                        End If
                        'против часовой из нижнего левого угла 4-3-2-1
                            If atan(i) &gt;= -180 And atan(i) &lt;= -90 Then
                                qvadr(i) = 1
                            ElseIf atan(i) &gt; -90 And atan(i) &lt;= 0 Then
                                qvadr(i) = 2
                            ElseIf atan(i) &gt; 0 And atan(i) &lt;= 90 Then
                                qvadr(i) = 3
                            ElseIf atan(i) &gt; 90 And atan(i) &lt;= 180 Then
                                qvadr(i) = 4
                            Else
                                qvadr(i) = 0
                            End If
                      Debug.Print svet(i).NameU & " " & dx(i) & " - " & dy(i) & " " & atan(i) & " " & qvadr(i)
                    '    svet(i).Characters.text = CStr(atan(i))
                    '  Debug.Print Passive(i) & " " & svet(i).Name & " " & y(i) & "  " & room(i)
                      Next i

Debug.Print "---------------sort-------------"


         For i = 0 To UBound(Passive) - 1
            For j = i + 1 To UBound(Passive) - 1
        
                If qvadr(i) &gt; qvadr(j) Then
                   
                  Set temp = Passive(i)
                  Set Passive(i) = Passive(j)
                  Set Passive(j) = temp
                  
                  temp = room(i)
                  room(i) = room(j)
                  room(j) = temp
                  
                  temp = atan(i)
                  atan(i) = atan(j)
                  atan(j) = temp
                  
                  temp = num(i)
                  num(i) = num(j)
                  num(j) = temp
                 
                  temp = qvadr(i)
                  qvadr(i) = qvadr(j)
                  qvadr(j) = temp
                  
                 ElseIf qvadr(i) = qvadr(j) Then
                         If Passive(i).Cells("pinY") - Passive(j).Cells("pinY") &gt; 0.2 Then
                         
                              Set temp = Passive(i)
                              Set Passive(i) = Passive(j)
                              Set Passive(j) = temp
                              
                              temp = room(i)
                              room(i) = room(j)
                              room(j) = temp
                              
                                temp = num(i)
                                num(i) = num(j)
                                num(j) = temp
                                
                              temp = atan(i)
                              atan(i) = atan(j)
                              atan(j) = temp
            
                              temp = qvadr(i)
                              qvadr(i) = qvadr(j)
                              qvadr(j) = temp
                              
                          ElseIf Passive(i).Cells("pinY") - Passive(j).Cells("pinY") &lt;= 0.2 Then
                                If Passive(i).Cells("pinX") &gt; Passive(j).Cells("pinX") Then
                                      Set temp = Passive(i)
                                      Set Passive(i) = Passive(j)
                                      Set Passive(j) = temp
                                      
                                      temp = room(i)
                                      room(i) = room(j)
                                      room(j) = temp
                                      
                                temp = num(i)
                                num(i) = num(j)
                                num(j) = temp
                                
                                      temp = atan(i)
                                      atan(i) = atan(j)
                                      atan(j) = temp
                    
                                      temp = qvadr(i)
                                      qvadr(i) = qvadr(j)
                                      qvadr(j) = temp
                                 End If
                          End If
                End If
            Next j
        Next i

delta_x = 1.5
dx_con = 0
dx_con = dx_con + delta_x

If sho.Cells("angle") &lt; -3.14 * 0.95 Or sho.Cells("angle") &gt; 3.14 * 0.95 Then
endI = 0
startI = UBound(Passive) - 1
stepi = -1

Else
startI = 0
endI = UBound(Passive) - 1
stepi = 1

End If
Debug.Print formi
              For i = startI To endI Step stepi 'Passive присоединения к щитку все пассивные
              Debug.Print Passive(i) & " " & room(i) & " " _
              & Round(Passive(i).Cells("pinY"), 1) & " " & Round(Passive(i).Cells("pinX"), 1) _
              & " " & qvadr(i) & " " & atan(i)
              'место на шейпе ЩО
              If stepi = 1 Then sho.Cells("Connections.Y" & num(i) + 1).FormulaU = "=height*" & (i + 1) * (1 / (UBound(Passive) + 1))
              If stepi = -1 Then sho.Cells("Connections.Y" & num(i) + 1).FormulaU = "=height*(1-" & (i + 1) * (1 / (UBound(Passive) + 1)) & ")"
            '  Passive(i).Cells("Geometry1.X3").FormulaU = "=" & dx_con & " mm"
            ' Passive(i).Cells("Geometry1.X2").FormulaU = "=" & dx_con & " mm"
           '   dx_con = dx_con + delta_x
              Next

    ActiveWindow.DeselectAll
    ActiveWindow.Select sho, visSelect
    Application.ActiveWindow.Selection.Move -0.01, 0#
    Application.ActiveWindow.Selection.Move 0.01, 0#
    
 Next vid
 
Debug.Print "---------------------------------"



End Sub</font></pre><br />для начала хоть его бы отладить ) <br /><br /> <blockquote id="quote"><font size="1" face="Verdana, Arial, Helvetica" id="quote">quote:<hr height="1" noshade id="quote">Потом вычисляем стены, тросы, дверные проемы, светильники (выводы), которые он накрыл (или пересек)<hr height="1" noshade id="quote"></font></blockquote><br />не ясна идея. есть <br />- границы комнат<br />   по ним надо бы вычислить положение дверей. как ? по идее надо пройтись по периметру проверяя "есть прямая ли линия (читай стена) в непосредственно близости". если нет - это дверь. вопрос как выполнить эту проверку ? <br /><pre id="code"><font face="courier" size="2" id="code">Логично было бы человеку как-то "мазнуть", наметить путь, а макрос красиво уложил бы все в намеченный след.</font></pre><br />на каком основании макрос бы уложил красиво то ? ибо если можно уложить по намеченному руками пути - можно потом попробовать путь вычислить машинно.<br />в принципе при верной сортировке на щитке (см. макрос выше) все ручное укладывание шейпов заключается в смещении буквально двух трех прямых отрезков ближе к стене/другим линиям... вот думаю может в эти ворота сыграть... <br /><br /><br /><br /></span></font></td>
                    </tr>
                    <tr>
                      <td valign="bottom" align="right" height="20"><a href="topic.asp@TOPIC_ID=2330.html#top"><img src="icon_go_up.gif" width="15" height="15" border="0" alt="Go to Top of Page" title="Go to Top of Page" align="right" /></a></td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td bgcolor="gainsboro" valign="top" width="100" nowrap>
                <p><font face="Verdana, Arial, Helvetica" size="2"><b><span class="spnMessageText">bdfy</span></b></font><br />
                </p>
                <p>
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>Belarus</small></font><br />
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>267 Posts</small></font></p></td>
                <td bgcolor="gainsboro" height="100%" width="100%" colspan="2" valign="top"><a name="4416"></a>
                  <table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td valign="top">
                      <img src="icon_posticon.gif" width="15" height="15" border="0" alt="" title="" hspace="3" /><font color="midnightblue" face="Verdana, Arial, Helvetica" size="1">Posted&nbsp;-&nbsp;04/02/2010&nbsp;:&nbsp; 09:35:35</font>
                      <hr noshade size="1"></td>
                    </tr>
                    <tr>
                      <td valign="top" height="100%"><font face="Verdana, Arial, Helvetica" size="2" color="midnightblue"><span class="spnMessageText" id="msg"> все идет к тому что делать все придется руками (( что выливается в несколько человеко суток (( <br />что не нравится в визио - коннектор можно тащить только за сгиб или за середину линии. а можно ли сделать так чтобы прямую коннектора можно было оттянуть в сторону взявшись в любом месте ?</span></font></td>
                    </tr>
                    <tr>
                      <td valign="bottom" align="right" height="20"><a href="topic.asp@TOPIC_ID=2330.html#top"><img src="icon_go_up.gif" width="15" height="15" border="0" alt="Go to Top of Page" title="Go to Top of Page" align="right" /></a></td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td bgcolor="whitesmoke" valign="top" width="100" nowrap>
                <p><font face="Verdana, Arial, Helvetica" size="2"><b><span class="spnMessageText">Tumanov</span></b></font><br />
                </p>
                <p>
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>Russia</small></font><br />
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>1198 Posts</small></font></p></td>
                <td bgcolor="whitesmoke" height="100%" width="100%" colspan="2" valign="top"><a name="4417"></a>
                  <table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td valign="top">
                      <img src="icon_posticon.gif" width="15" height="15" border="0" alt="" title="" hspace="3" /><font color="midnightblue" face="Verdana, Arial, Helvetica" size="1">Posted&nbsp;-&nbsp;04/02/2010&nbsp;:&nbsp; 16:21:14</font>
                      <hr noshade size="1"></td>
                    </tr>
                    <tr>
                      <td valign="top" height="100%"><font face="Verdana, Arial, Helvetica" size="2" color="midnightblue"><span class="spnMessageText" id="msg"> <blockquote id="quote"><font size="1" face="Verdana, Arial, Helvetica" id="quote">quote:<hr height="1" noshade id="quote">все идет к тому что делать все придется руками<hr height="1" noshade id="quote"></font></blockquote><br />Ну, как-то слишком пессимистично...<br />Я, в общем-то, давно собирался поисследовать возможности Visio в графической навигации, да все повода не было. Вот может как раз случай представился :) Глядишь, что-нибудь и получится.<br />Смотрю, из инструментов есть функция шейп-листа, позволяющая определить точку пересечения прямых.<br />=INTERSECTY(PinX,PinY,Angle,Sheet.2!PinX,Sheet.2!PinY,Sheet.2!Angle)<br />Может помочь для прогнозирования возможных точек пересечения. Это если вместо коннекторов самому строить соединительные линии.<br />Есть возможность вычислить особенности взаимного расположения шейпов, например, факт пересечения. В том числе и коннекторов.<br />Debug.Print sh1.SpatialRelation(sh2, 0.1, 0)<br />при пересечении коннекторов возвращает 8, для непересекающихся - 0.<br />То есть наблюдая реальную ситуацию, можно найти пересекающиеся коннекторы. Затем, переключая один из концов коннектора, добиться отсутствия перемещений.<br />В определении положения дверей скорее всего может помочь имеющийся шейп типа дверного проема (название не помню). Выглядит, как дырка в стене, но на самом деле является шейпом. Нужно только использовать их при рисовании, если это допускает технология.<br />С коннекторами, помнится, тоже был момент, когда не удавалось добиться нужного поведения. Так я после проводки коннекторов превращал их макросом в обычные ломаные (с той же геометрией) и потом уже перетаскивал нужные куски. То есть, можно еще поискать варианты :)<br />А предварительная наметка пути, как мне кажется, может помочь вот  в чем. Если просто взять пару соединений (четыре точки в помещении), то в зависимости от того, по какой стене идти (по часовой или против), коннекторы либо перекрестятся, либо нет. Поэтому путь важен. Хочу извлечь из него последовательность шейпов, мимо которых нужно пройти. А потом последовательно от одного шейпа до другого (рядом) тянуть свои связи.<br />Можно, наверно, и без предварительной наметки обойтись, но тогда придется путь вычислять алгоритмически. А значит, отрабатывать для этого еще один алгоритм, может быть не очень простой.<br />Короче, результаты пока прогнозировать рано, но в целом задача видится разрешимой.</span></font></td>
                    </tr>
                    <tr>
                      <td valign="bottom" align="right" height="20"><a href="topic.asp@TOPIC_ID=2330.html#top"><img src="icon_go_up.gif" width="15" height="15" border="0" alt="Go to Top of Page" title="Go to Top of Page" align="right" /></a></td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td bgcolor="gainsboro" valign="top" width="100" nowrap>
                <p><font face="Verdana, Arial, Helvetica" size="2"><b><span class="spnMessageText">bdfy</span></b></font><br />
                </p>
                <p>
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>Belarus</small></font><br />
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>267 Posts</small></font></p></td>
                <td bgcolor="gainsboro" height="100%" width="100%" colspan="2" valign="top"><a name="4418"></a>
                  <table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td valign="top">
                      <img src="icon_posticon.gif" width="15" height="15" border="0" alt="" title="" hspace="3" /><font color="midnightblue" face="Verdana, Arial, Helvetica" size="1">Posted&nbsp;-&nbsp;04/02/2010&nbsp;:&nbsp; 17:24:28</font>
                      <hr noshade size="1"></td>
                    </tr>
                    <tr>
                      <td valign="top" height="100%"><font face="Verdana, Arial, Helvetica" size="2" color="midnightblue"><span class="spnMessageText" id="msg"> <blockquote id="quote"><font size="1" face="Verdana, Arial, Helvetica" id="quote">quote:<hr height="1" noshade id="quote">Ну, как-то слишком пессимистично...<hr height="1" noshade id="quote"></font></blockquote><br />дедлайн просто числа 15-20 - а схем сейчас уже под 50,а будет больше (<br />пока я задачу вижу из 3 пунктов<br />- разместить выключатели (это я примерно представляю еще как сделать). только вот использовать какие то шейпы нельзя для дверей - схемы все были изначально рисованы в автокаде, потом конвертированы. сейчас их править таким образом достаточно сложно. <br />- отсортировать соединения на самом щитке ЩО/ЩАО. наработки есть - но работает не всегда корректно. <br />- провести проводники по тросам/стенам. вот это наиболее сложная и трудоемкая часть. я сегодня чертежей пять сделал - убил наверное часа полтора и удовольствия не получил никакого (( <br /> <blockquote id="quote"><font size="1" face="Verdana, Arial, Helvetica" id="quote">quote:<hr height="1" noshade id="quote">А предварительная наметка пути, как мне кажется, может помочь вот в чем. Если просто взять пару соединений (четыре точки в помещении), то в зависимости от того, по какой стене идти (по часовой или против), коннекторы либо перекрестятся, либо нет. Поэтому путь важен. Хочу извлечь из него последовательность шейпов, мимо которых нужно пройти. А потом последовательно от одного шейпа до другого (рядом) тянуть свои связи.<hr height="1" noshade id="quote"></font></blockquote><br />а если просто засечь ближайшие стены,тросы и уже уложенные коннекторы и просто максимально "прижать" коннектор к ним ? только как это запускаться то хотя бы будет ? "предварительный путь" можно словить через Document_ShapeAdded предположим, а как указать какой из коннекторов по нему ложить ? если просто по порядку, то порядок еще надо определить...<br /> <blockquote id="quote"><font size="1" face="Verdana, Arial, Helvetica" id="quote">quote:<hr height="1" noshade id="quote">С коннекторами, помнится, тоже был момент, когда не удавалось добиться нужного поведения. Так я после проводки коннекторов превращал их макросом в обычные ломаные (с той же геометрией) и потом уже перетаскивал нужные куски.<hr height="1" noshade id="quote"></font></blockquote><br />у коннектора есть свойство line routing - reroute - never <br />если верить справке - это автоматические смещения прекращает. <br /><br />в любом случае еще недельку в принципе можно подергатся  ) все же ведь "лучше день потерять... потом за пять минут долететь". <br />могу залить на мыло проект целиком если это поможет. все файлы метров в 10 уложатся  думаю. мыло только подскажите ) <br /><br /><br /><br /><br /><br /></span></font></td>
                    </tr>
                    <tr>
                      <td valign="bottom" align="right" height="20"><a href="topic.asp@TOPIC_ID=2330.html#top"><img src="icon_go_up.gif" width="15" height="15" border="0" alt="Go to Top of Page" title="Go to Top of Page" align="right" /></a></td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td bgcolor="whitesmoke" valign="top" width="100" nowrap>
                <p><font face="Verdana, Arial, Helvetica" size="2"><b><span class="spnMessageText">bdfy</span></b></font><br />
                </p>
                <p>
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>Belarus</small></font><br />
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>267 Posts</small></font></p></td>
                <td bgcolor="whitesmoke" height="100%" width="100%" colspan="2" valign="top"><a name="4419"></a>
                  <table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td valign="top">
                      <img src="icon_posticon.gif" width="15" height="15" border="0" alt="" title="" hspace="3" /><font color="midnightblue" face="Verdana, Arial, Helvetica" size="1">Posted&nbsp;-&nbsp;04/02/2010&nbsp;:&nbsp; 17:28:34</font>
                      <hr noshade size="1"></td>
                    </tr>
                    <tr>
                      <td valign="top" height="100%"><font face="Verdana, Arial, Helvetica" size="2" color="midnightblue"><span class="spnMessageText" id="msg"> была еще идея закрыть "условно непроходимые зоны", т.е центральную часть помещений большим шейпом со свойством route around - тогда по идее визио обязан был бы просчитать вокруг него пути, но не выходит из этого ничего пока (( бывает дейсвительно более менее корректно отталкивает коннекторы - потом сам улетает... как то странно эта фича работает.<br />....<br />а ведь даже работает )) даже почти похоже на правду получается. <br />только надо шейпами фейковыми закрыть еще и просветы между комнатами - а то коннекторы уходят туда.<br />....<br />вот что получилось если их закрыть ручками:<br /><a href="http://rapidshare.com/files/371217425/__________________10.rar.html" target="_blank">http://rapidshare.com/files/371217425/__________________10.rar.html</a><br />вопрос как закрыть подобными псевдношейпами все промежутки между комнатами ? и как отсортировать шейпы внутри "каналов" между шейпами. <br />хотя может это и тупиковое решение...</span></font></td>
                    </tr>
                    <tr>
                      <td valign="bottom"><hr noshade size="1" color="whitesmoke"><font face="Verdana, Arial, Helvetica" size="1" color="midnightblue">Edited by - bdfy on 04/02/2010  18:29:45</font></td>
                    </tr>
                    <tr>
                      <td valign="bottom" align="right" height="20"><a href="topic.asp@TOPIC_ID=2330.html#top"><img src="icon_go_up.gif" width="15" height="15" border="0" alt="Go to Top of Page" title="Go to Top of Page" align="right" /></a></td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td bgcolor="gainsboro" valign="top" width="100" nowrap>
                <p><font face="Verdana, Arial, Helvetica" size="2"><b><span class="spnMessageText">Tumanov</span></b></font><br />
                </p>
                <p>
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>Russia</small></font><br />
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>1198 Posts</small></font></p></td>
                <td bgcolor="gainsboro" height="100%" width="100%" colspan="2" valign="top"><a name="4420"></a>
                  <table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td valign="top">
                      <img src="icon_posticon.gif" width="15" height="15" border="0" alt="" title="" hspace="3" /><font color="midnightblue" face="Verdana, Arial, Helvetica" size="1">Posted&nbsp;-&nbsp;04/04/2010&nbsp;:&nbsp; 12:08:50</font>
                      <hr noshade size="1"></td>
                    </tr>
                    <tr>
                      <td valign="top" height="100%"><font face="Verdana, Arial, Helvetica" size="2" color="midnightblue"><span class="spnMessageText" id="msg"> 1. Да, сроки слишком жесткие. Я в них (на фоне других работ) точно не уложусь :( Разве что в следующий раз когда-нибудь пригодится...<br />2. Сортировка коннекторов. Сейчас видится ряд функций, которые могли бы помочь в работе:<br />2.1. Выбрать коннекторы, касающиеся заданного коннектора (например, селектированного). Функция работает на основе SpatialNeighbors. Причем за счет параметра Tolerance можно ловить как непосредственно касающиеся (и пересекающие), так и близко проходящие.<br />2.2. Функция перестановки двух соседних коннекторов. На том участке, где линии коннекторов идут рядом, пытается обвести второй коннектор вокруг первого. В зависимости от направления поворота первого коннектора в очередной точке излома смещает сегмент второго коннектора в нужную сторону.<br />Результат контролируется функцией 2.1. Если коннекторы все равно касаются, значит меняются местами их подключения к ЩО и операция повторяется.<br />Сегмент коннектора вроде тянется без проблем за две точки. Типа, вот так:<br />    sh1.Cells("Geometry1.X2") = sh1.Cells("Geometry1.X2") + 0.2<br />    sh1.Cells("Geometry1.X3") = sh1.Cells("Geometry1.X3") + 0.2<br />Скорее всего по ходу дела тут еще несколько мелких вспомогательных функций сформируется. Типа вычисления направления поворота, поиска близлежащих сегментов двух коннекторов и т.д.<br />3. Идея закрыть "непроходимые зоны" вроде хорошая. Для закрытия промежутков между помещениями можно ведь и просто слепить шейп, пользуясь операциями Subtract и Union. Если еще и стены в нескольких цехах совпадают, то такой шейп можно применять на нескольких листах. Или слегка изменять при необходимости.<br />А если все-таки не получится, можно попробовать провести несколько направляющих и пытаться тянуться к ним. В принципе, они обсчитываются, как обычные шейпы. Удается определить расстояние до них и т.д.<br /> <blockquote id="quote"><font size="1" face="Verdana, Arial, Helvetica" id="quote">quote:<hr height="1" noshade id="quote">могу залить на мыло проект целиком если это поможет. все файлы метров в 10 уложатся думаю. мыло только подскажите<hr height="1" noshade id="quote"></font></blockquote><br />С учетом того, что я в срок задачу не решу, вроде как и смысла нет заливать. А если с учетом перспективы, то реальные данные никогда не помешают. Больше особенностей можно учесть. Так что, смотрите сами. почта <a href="mailto:ttt@post.rzn.ru">ttt@post.rzn.ru</a> В несколько Мб письма вроде проходили.</span></font></td>
                    </tr>
                    <tr>
                      <td valign="bottom" align="right" height="20"><a href="topic.asp@TOPIC_ID=2330.html#top"><img src="icon_go_up.gif" width="15" height="15" border="0" alt="Go to Top of Page" title="Go to Top of Page" align="right" /></a></td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td bgcolor="whitesmoke" valign="top" width="100" nowrap>
                <p><font face="Verdana, Arial, Helvetica" size="2"><b><span class="spnMessageText">bdfy</span></b></font><br />
                </p>
                <p>
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>Belarus</small></font><br />
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>267 Posts</small></font></p></td>
                <td bgcolor="whitesmoke" height="100%" width="100%" colspan="2" valign="top"><a name="4421"></a>
                  <table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td valign="top">
                      <img src="icon_posticon.gif" width="15" height="15" border="0" alt="" title="" hspace="3" /><font color="midnightblue" face="Verdana, Arial, Helvetica" size="1">Posted&nbsp;-&nbsp;04/04/2010&nbsp;:&nbsp; 15:53:47</font>
                      <hr noshade size="1"></td>
                    </tr>
                    <tr>
                      <td valign="top" height="100%"><font face="Verdana, Arial, Helvetica" size="2" color="midnightblue"><span class="spnMessageText" id="msg"> сроки уже не горят -  хлопчыка раскидывать это дело вручную я уже нанял <img src="icon_smile_big.gif" width="15" height="15" border="0" alt="" title="" align="middle" />, но нормально автоматическое решение все равно интересно. ибо хлопчыки девайс в общем случае менее надежный и менее производительный чем программа ) да и задачи подобные мне попадаются периодически. <br />  <blockquote id="quote"><font size="1" face="Verdana, Arial, Helvetica" id="quote">quote:<hr height="1" noshade id="quote">3. Идея закрыть "непроходимые зоны" вроде хорошая. Для закрытия промежутков между помещениями можно ведь и просто слепить шейп, пользуясь операциями Subtract и Union. Если еще и стены в нескольких цехах совпадают, то такой шейп можно применять на нескольких листах.<hr height="1" noshade id="quote"></font></blockquote><br />все таки решение ищется автоматическое ) внутри комнат заполнить пространство легко, вот между ними сложнее -  если комнаты вложены одна в другую - да субстракт поможет. а если просто рядом стоят с просветами ? как эти просветы посчитать и заполнить ? <br />а так если фигуры эти корректно поставить - остается только отсортировать коннекторы в "коридорах" образаванных этими шейпами. тут правда опять стоит вопрос как...<img src="icon_smile_question.gif" width="15" height="15" border="0" alt="" title="" align="middle" /><br /> <blockquote id="quote"><font size="1" face="Verdana, Arial, Helvetica" id="quote">quote:<hr height="1" noshade id="quote">Сегмент коннектора вроде тянется без проблем за две точки. Типа, вот так:<hr height="1" noshade id="quote"></font></blockquote><br />вообще говоря я спрашивал можно ли при ручном редактировании коннектор тянуть за точки отличные от перегибов и середин отрезков. <br /><br />на прожект ссылка на почте. будет время, скажите пару добрых ) не уверен правда что разберетесь в этом комбайне )</span></font></td>
                    </tr>
                    <tr>
                      <td valign="bottom" align="right" height="20"><a href="topic.asp@TOPIC_ID=2330.html#top"><img src="icon_go_up.gif" width="15" height="15" border="0" alt="Go to Top of Page" title="Go to Top of Page" align="right" /></a></td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td align="center" bgcolor="midnightblue" width="100" nowrap><b><font face="Verdana, Arial, Helvetica" size="2" color="mintcream">&nbsp;</font></b></td>
                <td align="center" bgcolor="midnightblue" width="100"><b><font face="Verdana, Arial, Helvetica" size="2" color="mintcream">
                <a href="topic.asp@TOPIC_ID=2228.html"><img src="icon_go_left.gif" width="15" height="15" border="0" alt="Previous Topic" title="Previous Topic" align="top" hspace="6" /></a><b><font face="Verdana, Arial, Helvetica" size="2" color="mintcream">&nbsp;Topic&nbsp;</font></b><a href="topic.asp@TOPIC_ID=300.html"><img src="icon_go_right.gif" width="15" height="15" border="0" alt="Next Topic" title="Next Topic" align="top" hspace="6" /></a></font></b></td>
                <td align="right" bgcolor="midnightblue" nowrap><font face="Verdana, Arial, Helvetica" size="2">&nbsp;</font></td>
              </tr>
            </table>
          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table align="center" border="0" cellPadding="0" cellSpacing="0" width="95%">
  <tr>
    <td>
      <table width="100%">
        <tr>
          <td align="center" bgcolor="#ffffAA"><font face="Verdana, Arial, Helvetica" size="2">Данный сайт является архивом форума visio.artberg.ru, который был закрыт в связи с переходом на новую платформу <b><a href="http://visio.getbb.ru">visio.getbb.ru</a></b><br/>Все материалы доступны только для чтения! Если у вас появились вопросы, или вы хотите что-то обсудить, связанное с Visio, обращайтесь на новый форум!<br/>Архив был создан благодаря совместным усилиям Генадия Туманова @Tumanov (<a href="http://visio.artberg.ru">visio.artberg.ru</a>), Александра ака @Surrogate (<a href="http://visio.getbb.ru">visio.getbb.ru</a>), и Николая Белых @nbelyh (<a href="http://unmanagedvisio.com">unmanagedvisio.com</a>)</font></td>
        </tr>
      </table>
  </td>
 </tr>
</table>
</body>
</html>
