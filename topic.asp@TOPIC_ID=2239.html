<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>
<title>Visio - Автозамена фигур на странице</title>
<meta name="copyright" content="This Forum code is Copyright (C) 2000-09 Michael Anderson, Pierre Gorissen, Huw Reddick and Richard Kinser, Non-Forum Related code is Copyright (C) 2000-02 Snitz Communications">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" >
<style type="text/css">
<!--
a:link    {color:darkblue;text-decoration:underline}
a:visited {color:blue;text-decoration:underline}
a:hover   {color:red;text-decoration:underline}
a:active  {color:red;text-decoration:}
.spnMessageText a:link    {color:darkblue;text-decoration:underline}
.spnMessageText a:visited {color:blue;text-decoration:underline}
.spnMessageText a:hover   {color:red;text-decoration:underline}
.spnMessageText a:active  {color:red;text-decoration:underline}
.spnSearchHighlight {background-color:yellow}
input.radio {background:lightsteelblue;color:#000000}
-->
</style>
</head>

<body bgColor="white" text="midnightblue" link="darkblue" aLink="red" vLink="blue">
<a name="top"></a>

<script>(function() { var cx = '002792228947284598284:fmq7et_yt8s'; var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true; gcse.src = 'https://cse.google.com/cse.js?cx=' + cx; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s); })();</script>
<div style='height: 70px; margin-left:10%; width: 80%; text-align:right;'><div class='gcse-search'></div></div>
<table align="center" border="0" cellPadding="0" cellSpacing="0" width="95%">
  <tr>
    <td>
    
    
      <table border="0" width="100%">
        <tr>
          <td width="50%" align="left" nowrap><font face="Verdana, Arial, Helvetica" size="2">
          <img src="icon_folder_open.gif" width="15" height="15" border="0" alt="" title="" align="absmiddle" />&nbsp;<a href="default.asp.html">All Forums</a><br />
          <img src="icon_bar.gif" width="15" height="15" border="0" alt="" title="" align="absmiddle" /><img src="icon_folder_open.gif" width="15" height="15" border="0" alt="" title="" align="absmiddle" />&nbsp;<a href="default.asp@CAT_ID=2.html">Категория Visio</a><br />
          <img src="icon_blank.gif" width="15" height="15" border="0" alt="" title="" align="absmiddle" /><img src="icon_bar.gif" width="15" height="15" border="0" alt="" title="" align="absmiddle" /><img src="icon_folder_open.gif" width="15" height="15" border="0" alt="" title="" align="absmiddle" />&nbsp;<a href="forum.asp@FORUM_ID=2.html">Форум Вопросы и ответы</a><br />
          <img src="icon_blank.gif" width="15" height="15" border="0" alt="" title="" align="absmiddle" /><img src="icon_blank.gif" width="15" height="15" border="0" alt="" title="" align="absmiddle" /><img src="icon_bar.gif" width="15" height="15" border="0" alt="" title="" align="absmiddle" /><img src="icon_folder_open_topic.gif" width="15" height="15" border="0" alt="" title="" align="absmiddle" />&nbsp;Автозамена фигур на странице</font></td>
          <td align="center" width="50%">
          <font face="Verdana, Arial, Helvetica" size="2">
          </font></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table align="center" border="0" cellPadding="0" cellSpacing="0" width="95%">
  <tr>
    <td>
      <table border="0" width="100%" cellspacing="0" cellpadding="0" align="center">
        <tr>
          <td bgcolor="black">
            <table border="0" width="100%" cellspacing="1" cellpadding="4">
              <tr>
                <td align="center" bgcolor="midnightblue" width="100" nowrap><b><font face="Verdana, Arial, Helvetica" size="2" color="mintcream">Author</font></b></td>
                <td align="center" bgcolor="midnightblue" width="100"><b><font face="Verdana, Arial, Helvetica" size="2" color="mintcream">
                <a href="topic.asp@TOPIC_ID=2248.html"><img src="icon_go_left.gif" width="15" height="15" border="0" alt="Previous Topic" title="Previous Topic" align="top" hspace="6" /></a><b><font face="Verdana, Arial, Helvetica" size="2" color="mintcream">&nbsp;Topic&nbsp;</font></b><a href="topic.asp@TOPIC_ID=2233.html"><img src="icon_go_right.gif" width="15" height="15" border="0" alt="Next Topic" title="Next Topic" align="top" hspace="6" /></a></font></b></td>
                <td align="right" bgcolor="midnightblue" nowrap><font face="Verdana, Arial, Helvetica" size="2">&nbsp;</font></td>
              </tr>
              <tr>
                <td bgcolor="whitesmoke" valign="top" width="100" nowrap>
                <p><font color="midnightblue" face="Verdana, Arial, Helvetica" size="2"><b><span class="spnMessageText">bdfy</span></b></font><br />
                </p>
                <p>
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>Belarus</small></font><br />
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>267 Posts</small></font></p></td>
                <td bgcolor="whitesmoke" width="100%" colspan="2" valign="top">
                  <table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td valign="top">
                      <img src="icon_posticon.gif" width="15" height="15" border="0" alt="" title="" hspace="3" /><font color="midnightblue" face="Verdana, Arial, Helvetica" size="1">Posted&nbsp;-&nbsp;02/05/2009&nbsp;:&nbsp; 20:25:09</font>
                      <hr noshade size="1"></td>
                    </tr>
                    <tr>
                      <td valign="top" height="100%"><font face="Verdana, Arial, Helvetica" size="2" color="midnightblue"><span class="spnMessageText" id="msg"> Есть набор точек узлов, которые нужно соединить линиями при этом нанося на линии опр. инфу (длина). Смартшейп такой линии я без проблем создал, но вытягивать шаблон и присоединять его крайние точки к узлам неудобно. рисовать хочется аки линиями. думаю единственный вариант, это макрос подмены линий на смартшейп написать. <br /> <blockquote id="quote"><font size="1" face="Verdana, Arial, Helvetica" id="quote">quote:<hr height="1" noshade id="quote">Private Sub Document_ShapeAdded(ByVal vsoShape As Visio.IVShape)<br /><br />    Dim vsoMaster As Visio.Master<br />    <br />    Dim vsoPage As Visio.Page<br /><br />    Dim vsoBegX As Visio.Cell<br />    Dim vsoBegY As Visio.Cell<br />    Dim vsoEndX As Visio.Cell<br />    Dim vsoEndY As Visio.Cell<br />    Dim vsoWidth As Visio.Cell<br />    <br />    Dim strBowCell As String<br />    Dim strBowFormula As String<br />    Dim intIndex As Integer<br />    Dim intCounter As Integer<br />    <br />   'Set vsoCell to the Scratch.X1 cell and set its formula.<br />    Set vsoBegX = vsoShape.Cells("BeginX")<br />    Set vsoBegY = vsoShape.Cells("BeginY")<br />    Set vsoEndX = vsoShape.Cells("EndX")<br />    Set vsoEndY = vsoShape.Cells("EndY")<br />    Set vsoWidth = vsoShape.Cells("Width")<br />    <br /><br />    MsgBox "длина " & vsoWidth * 25.4<br />End Sub<hr height="1" noshade id="quote"></font></blockquote><br />собственно на этом я и уперся ((<br />1. как определить что vsoShape именно линия ? <br />2. как правильно вытянуть на лист мастер ("line" в документе называется) ибо запись макроса дает длиннющий код...<br /><br /></span></font></td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td bgcolor="gainsboro" valign="top" width="100" nowrap>
                <p><font face="Verdana, Arial, Helvetica" size="2"><b><span class="spnMessageText">Tumanov</span></b></font><br />
                </p>
                <p>
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>Russia</small></font><br />
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>1198 Posts</small></font></p></td>
                <td bgcolor="gainsboro" height="100%" width="100%" colspan="2" valign="top"><a name="4054"></a>
                  <table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td valign="top">
                      <img src="icon_posticon.gif" width="15" height="15" border="0" alt="" title="" hspace="3" /><font color="midnightblue" face="Verdana, Arial, Helvetica" size="1">Posted&nbsp;-&nbsp;02/06/2009&nbsp;:&nbsp; 18:46:49</font>
                      <hr noshade size="1"></td>
                    </tr>
                    <tr>
                      <td valign="top" height="100%"><font face="Verdana, Arial, Helvetica" size="2" color="midnightblue"><span class="spnMessageText" id="msg"> 1. Ненулевое значение (True) свойства OneD.<br />Можно дополнительно убедиться, что имеется ровно одна секция геометрии и в ней ровно три строки.<br />    Debug.Print sh.OneD<br />    Debug.Print sh.GeometryCount<br />    Debug.Print sh.RowCount(visSectionFirstComponent)<br />И типы у строк должны быть 137, 138 и 139 (visTagComponent, visTagMoveTo и visTagLineTo соответственно)<br />    Debug.Print sh.RowType(visSectionFirstComponent, 0)<br />    Debug.Print sh.RowType(visSectionFirstComponent, 1)<br />    Debug.Print sh.RowType(visSectionFirstComponent, 2)<br />И при этом не забывать, что придется отделять "нужные" линии от всех остальных линий. <br />2. Пример в статье <a href="http://visio.artberg.ru/biblio/st005.htm" target="_blank">http://visio.artberg.ru/biblio/st005.htm</a></span></font></td>
                    </tr>
                    <tr>
                      <td valign="bottom" align="right" height="20"><a href="topic.asp@TOPIC_ID=2239.html#top"><img src="icon_go_up.gif" width="15" height="15" border="0" alt="Go to Top of Page" title="Go to Top of Page" align="right" /></a></td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td bgcolor="whitesmoke" valign="top" width="100" nowrap>
                <p><font face="Verdana, Arial, Helvetica" size="2"><b><span class="spnMessageText">bdfy</span></b></font><br />
                </p>
                <p>
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>Belarus</small></font><br />
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>267 Posts</small></font></p></td>
                <td bgcolor="whitesmoke" height="100%" width="100%" colspan="2" valign="top"><a name="4055"></a>
                  <table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td valign="top">
                      <img src="icon_posticon.gif" width="15" height="15" border="0" alt="" title="" hspace="3" /><font color="midnightblue" face="Verdana, Arial, Helvetica" size="1">Posted&nbsp;-&nbsp;02/06/2009&nbsp;:&nbsp; 18:49:58</font>
                      <hr noshade size="1"></td>
                    </tr>
                    <tr>
                      <td valign="top" height="100%"><font face="Verdana, Arial, Helvetica" size="2" color="midnightblue"><span class="spnMessageText" id="msg"> как то сложно в статье...<br />посидел еще вечер что-то получилось<br /> <blockquote id="quote"><font size="1" face="Verdana, Arial, Helvetica" id="quote">quote:<hr height="1" noshade id="quote">Private Sub Document_ShapeAdded(ByVal vsoShape As Visio.IVShape)<br /><br />    Dim vsoMaster As Visio.Master<br />    Set vsoMaster = vsoShape.Master<br /><br />    Dim vsoPage As Visio.Page<br /><br />    Dim vsoBegX As Visio.Cell<br />    Dim vsoBegY As Visio.Cell<br />    Dim vsoEndX As Visio.Cell<br />    Dim vsoEndY As Visio.Cell<br />    Dim vsoWidth As Visio.Cell<br />    <br />    Dim strBowCell As String<br />    Dim strBowFormula As String<br />    Dim intIndex As Integer<br />    Dim intCounter As Integer<br />    <br />   'Set vsoCell to the Scratch.X1 cell and set its formula.<br />    Set vsoBegX = vsoShape.Cells("BeginX")<br />    Set vsoBegY = vsoShape.Cells("BeginY")<br />    Set vsoEndX = vsoShape.Cells("EndX")<br />    Set vsoEndY = vsoShape.Cells("EndY")<br />    Set vsoWidth = vsoShape.Cells("Width")<br />    Set vsoWidth = vsoShape.Cells("Width")<br />    <br />    If (vsoMaster Is Nothing) Then<br />  '  vsoShape.CellsSRC(visSectionObject, visRowXForm1D, vis1DBeginX).FormulaU = vsoBegX & " mm"<br /><br />    Set vsoLine = Application.ActiveWindow.Page.Drop(Application.Documents.Item("G:\!!!#202;#243;#240;#241;#238;#226;#251;#229; #239;#238; #241;#229;#242;#255;#236;\#226;#224;#240;#232;#224;#237;#242;#251; #234;#238;#237;#244;#232;#227;#243;#240;#224;#246;#232;#232;.vsd").Masters.ItemU("line"), 0, 0)<br /><br />    vsoLine.CellsSRC(visSectionObject, visRowXForm1D, vis1DBeginX).FormulaU = vsoBegX<br />    vsoLine.CellsSRC(visSectionObject, visRowXForm1D, vis1DBeginY).FormulaU = vsoBegY<br />    vsoLine.CellsSRC(visSectionObject, visRowXForm1D, vis1DEndX).FormulaU = vsoEndX<br />    vsoLine.CellsSRC(visSectionObject, visRowXForm1D, vis1DEndY).FormulaU = vsoEndY<br />    'MsgBox "test " & Round(vsoWidth * 25.4, 1)<br />    'Get the Master property of the shape.<br />    End If<br /><br />End Sub<hr height="1" noshade id="quote"></font></blockquote><br />работает в принципе. можно ехать дальше.</span></font></td>
                    </tr>
                    <tr>
                      <td valign="bottom" align="right" height="20"><a href="topic.asp@TOPIC_ID=2239.html#top"><img src="icon_go_up.gif" width="15" height="15" border="0" alt="Go to Top of Page" title="Go to Top of Page" align="right" /></a></td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td bgcolor="gainsboro" valign="top" width="100" nowrap>
                <p><font face="Verdana, Arial, Helvetica" size="2"><b><span class="spnMessageText">bdfy</span></b></font><br />
                </p>
                <p>
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>Belarus</small></font><br />
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>267 Posts</small></font></p></td>
                <td bgcolor="gainsboro" height="100%" width="100%" colspan="2" valign="top"><a name="4058"></a>
                  <table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td valign="top">
                      <img src="icon_posticon.gif" width="15" height="15" border="0" alt="" title="" hspace="3" /><font color="midnightblue" face="Verdana, Arial, Helvetica" size="1">Posted&nbsp;-&nbsp;02/08/2009&nbsp;:&nbsp; 16:25:06</font>
                      <hr noshade size="1"></td>
                    </tr>
                    <tr>
                      <td valign="top" height="100%"><font face="Verdana, Arial, Helvetica" size="2" color="midnightblue"><span class="spnMessageText" id="msg"> не до конца здорово у меня получилось... ибо если линия была прилеплена к фигуре некой, "подмена" хоть и находится в тех же коорд. но не сцеплена получается. как получить к чему приклеена линия и приклеить так же новую ?</span></font></td>
                    </tr>
                    <tr>
                      <td valign="bottom" align="right" height="20"><a href="topic.asp@TOPIC_ID=2239.html#top"><img src="icon_go_up.gif" width="15" height="15" border="0" alt="Go to Top of Page" title="Go to Top of Page" align="right" /></a></td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td bgcolor="whitesmoke" valign="top" width="100" nowrap>
                <p><font face="Verdana, Arial, Helvetica" size="2"><b><span class="spnMessageText">Tumanov</span></b></font><br />
                </p>
                <p>
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>Russia</small></font><br />
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>1198 Posts</small></font></p></td>
                <td bgcolor="whitesmoke" height="100%" width="100%" colspan="2" valign="top"><a name="4059"></a>
                  <table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td valign="top">
                      <img src="icon_posticon.gif" width="15" height="15" border="0" alt="" title="" hspace="3" /><font color="midnightblue" face="Verdana, Arial, Helvetica" size="1">Posted&nbsp;-&nbsp;02/08/2009&nbsp;:&nbsp; 19:41:04</font>
                      <hr noshade size="1"></td>
                    </tr>
                    <tr>
                      <td valign="top" height="100%"><font face="Verdana, Arial, Helvetica" size="2" color="midnightblue"><span class="spnMessageText" id="msg"> К чему приклеена - получается через коллекцию Connects.<br />Примерно так<br />sh.Connects(1).ToSheet.NameID<br />А как прилепить, показано в уже упомянутой статье:<br /><blockquote id="quote"><font size="1" face="Verdana, Arial, Helvetica" id="quote">quote:<hr height="1" noshade id="quote">Получаем ссылку на ячейку шейп-листа, с значением начала коннектора <br />Set celBeginX = shpConnector.CellsSRC(visSectionObject, visRowXForm1D, vis1DBeginX) <br />Приклеиваем его к текущему шейпу <br />celBeginX.GlueTo elements(i).CellsSRC(visSectionObject, visRowXFormOut, visXFormPinX)<hr height="1" noshade id="quote"></font></blockquote> <br /></span></font></td>
                    </tr>
                    <tr>
                      <td valign="bottom" align="right" height="20"><a href="topic.asp@TOPIC_ID=2239.html#top"><img src="icon_go_up.gif" width="15" height="15" border="0" alt="Go to Top of Page" title="Go to Top of Page" align="right" /></a></td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td bgcolor="gainsboro" valign="top" width="100" nowrap>
                <p><font face="Verdana, Arial, Helvetica" size="2"><b><span class="spnMessageText">bdfy</span></b></font><br />
                </p>
                <p>
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>Belarus</small></font><br />
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>267 Posts</small></font></p></td>
                <td bgcolor="gainsboro" height="100%" width="100%" colspan="2" valign="top"><a name="4060"></a>
                  <table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td valign="top">
                      <img src="icon_posticon.gif" width="15" height="15" border="0" alt="" title="" hspace="3" /><font color="midnightblue" face="Verdana, Arial, Helvetica" size="1">Posted&nbsp;-&nbsp;02/09/2009&nbsp;:&nbsp; 19:00:57</font>
                      <hr noshade size="1"></td>
                    </tr>
                    <tr>
                      <td valign="top" height="100%"><font face="Verdana, Arial, Helvetica" size="2" color="midnightblue"><span class="spnMessageText" id="msg"> нашел в справке код как все коннекты получить последовательно.  <br /><blockquote id="quote"><font size="1" face="Verdana, Arial, Helvetica" id="quote">quote:<hr height="1" noshade id="quote">    Set vsoConnects = vsoShape.Connects<br />        For intCounter = 1 To vsoConnects.Count<br /><br />            Set vsoConnect = vsoConnects(intCounter)<br />            Set vsoConnectTo = vsoConnect.ToSheet<br />        Next intCounter<hr height="1" noshade id="quote"></font></blockquote><br /><br />но как оказалось привязка мне все равно не поможет (( <br />ибо даже если в точке привязки сходятся несколько линии - привязка идет только к одной. и возвращаюется тоже одна фигура. что конечно логично.<br />задачку следовательно можно так выразить:<br />есть сеть. в простейшем варианте вида:<br /><a href="http://img15.imageshack.us/my.php?image=setvz6.jpg" target="_blank">http://img15.imageshack.us/my.php?image=setvz6.jpg</a><br />узлы - один мастер-шейп. линии - другой.<br />нужно топологию составить по рисунку. т.е описать какие узлы ветви соединяют. <br />как я вижу:<br />выбрать все фигуры что под прямоугольником. выделить из них линии. <br />взять начало и конец линии и посмотреть есть ли в ближайшей окрестности точка узла. вот с этим проблемы. как вернуть ближайшую к точке фигуру заданного типа ?</span></font></td>
                    </tr>
                    <tr>
                      <td valign="bottom"><hr noshade size="1" color="gainsboro"><font face="Verdana, Arial, Helvetica" size="1" color="midnightblue">Edited by - bdfy on 02/09/2009  19:01:17</font></td>
                    </tr>
                    <tr>
                      <td valign="bottom" align="right" height="20"><a href="topic.asp@TOPIC_ID=2239.html#top"><img src="icon_go_up.gif" width="15" height="15" border="0" alt="Go to Top of Page" title="Go to Top of Page" align="right" /></a></td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td bgcolor="whitesmoke" valign="top" width="100" nowrap>
                <p><font face="Verdana, Arial, Helvetica" size="2"><b><span class="spnMessageText">Tumanov</span></b></font><br />
                </p>
                <p>
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>Russia</small></font><br />
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>1198 Posts</small></font></p></td>
                <td bgcolor="whitesmoke" height="100%" width="100%" colspan="2" valign="top"><a name="4061"></a>
                  <table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td valign="top">
                      <img src="icon_posticon.gif" width="15" height="15" border="0" alt="" title="" hspace="3" /><font color="midnightblue" face="Verdana, Arial, Helvetica" size="1">Posted&nbsp;-&nbsp;02/09/2009&nbsp;:&nbsp; 19:21:19</font>
                      <hr noshade size="1"></td>
                    </tr>
                    <tr>
                      <td valign="top" height="100%"><font face="Verdana, Arial, Helvetica" size="2" color="midnightblue"><span class="spnMessageText" id="msg"> Если нужно выбрать шейпы в окрестности точки, пользуйтесь SpatialSearch.<br />Это примерно так. Здесь в Selection собираются все шейпы, лежащие в радиусе 2 дюймов от центра шейпа sh.<br />Dim shs As Visio.Selection<br />Set sh = ActiveWindow.Selection(1)<br />x = sh.Cells("PinX")<br />y = sh.Cells("PinY")<br />Set shs = sh.Parent.SpatialSearch(x, y, visSpatialContainedIn Or visSpatialTouching, 2, 0)<br />Останется только из выбранных выбрать шейпы нужного типа.<br /></span></font></td>
                    </tr>
                    <tr>
                      <td valign="bottom" align="right" height="20"><a href="topic.asp@TOPIC_ID=2239.html#top"><img src="icon_go_up.gif" width="15" height="15" border="0" alt="Go to Top of Page" title="Go to Top of Page" align="right" /></a></td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td bgcolor="gainsboro" valign="top" width="100" nowrap>
                <p><font face="Verdana, Arial, Helvetica" size="2"><b><span class="spnMessageText">bdfy</span></b></font><br />
                </p>
                <p>
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>Belarus</small></font><br />
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>267 Posts</small></font></p></td>
                <td bgcolor="gainsboro" height="100%" width="100%" colspan="2" valign="top"><a name="4167"></a>
                  <table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td valign="top">
                      <img src="icon_posticon.gif" width="15" height="15" border="0" alt="" title="" hspace="3" /><font color="midnightblue" face="Verdana, Arial, Helvetica" size="1">Posted&nbsp;-&nbsp;03/25/2009&nbsp;:&nbsp; 20:15:28</font>
                      <hr noshade size="1"></td>
                    </tr>
                    <tr>
                      <td valign="top" height="100%"><font face="Verdana, Arial, Helvetica" size="2" color="midnightblue"><span class="spnMessageText" id="msg"> вот такой код сейчас использую<br /><pre id="code"><font face="courier" size="2" id="code">Public Function replaceShape(ByVal vsoShape As Visio.IVShape, ByVal newmaster As String) As Visio.IVShape
    Dim vsoBegX As Visio.Cell
    Dim vsoBegY As Visio.Cell
    Dim vsoEndX As Visio.Cell
    Dim vsoEndY As Visio.Cell
    Dim vsoWidth As Visio.Cell
   'Set vsoCell to the Scratch.X1 cell and set its formula.
    Set vsoBegX = vsoShape.Cells("BeginX")
    Set vsoBegY = vsoShape.Cells("BeginY")
    Set vsoEndX = vsoShape.Cells("EndX")
    Set vsoEndY = vsoShape.Cells("EndY")
    Set vsoWidth = vsoShape.Cells("Width")
    Set vsoWidth = vsoShape.Cells("Width")

  '  vsoShape.CellsSRC(visSectionObject, visRowXForm1D, vis1DBeginX).FormulaU = vsoBegX & " mm"
  '  Set vsoLine = Drop(Application.Documents.Item("G:\!!!#202;#243;#240;#241;#238;#226;#251;#229; #239;#238; #241;#229;#242;#255;#236;\#226;#224;#240;#232;#224;#237;#242;#251; #234;#238;#237;#244;#232;#227;#243;#240;#224;#246;#232;#232;.vsd").Masters.ItemU("line"), 0, 0)
    Set vsoNew = Application.ActiveWindow.Page.Drop(Application.Documents.Item("G:\!!!#202;#243;#240;#241;#238;#226;#251;#229; #239;#238; #241;#229;#242;#255;#236;\#226;#224;#240;#232;#224;#237;#242;#251; #234;#238;#237;#244;#232;#227;#243;#240;#224;#246;#232;#232;.vsd").Masters.ItemU(newmaster), 0, 0)

   ' expression.Drop(ObjectToDrop, xPos, yPos)
    vsoNew.CellsSRC(visSectionObject, visRowXForm1D, vis1DBeginX).FormulaU = vsoBegX
    vsoNew.CellsSRC(visSectionObject, visRowXForm1D, vis1DBeginY).FormulaU = vsoBegY
    vsoNew.CellsSRC(visSectionObject, visRowXForm1D, vis1DEndX).FormulaU = vsoEndX
    vsoNew.CellsSRC(visSectionObject, visRowXForm1D, vis1DEndY).FormulaU = vsoEndY
    vsoShape.Delete
    
    Set replaceShape = vsoNew
End Function</font></pre><br />первый параметр - шейп который меняем, второй параметр - имя мастера на который надо заменить. <br />код заменяет фигуру на новую, вписывает координаты. но это еще не все. нужно скопировать shape data, контролы, углы вращения и т.п -  все чем фигуры одного мастера могут отличатся на листе. как это сделать лучше чтобы ручками меньше кода писать ? можно было бы забить массив строк изменяемых - их не так много все таки. но функцию хочется универсальную для любых мастер-шейпов.</span></font></td>
                    </tr>
                    <tr>
                      <td valign="bottom"><hr noshade size="1" color="gainsboro"><font face="Verdana, Arial, Helvetica" size="1" color="midnightblue">Edited by - bdfy on 03/25/2009  20:16:23</font></td>
                    </tr>
                    <tr>
                      <td valign="bottom" align="right" height="20"><a href="topic.asp@TOPIC_ID=2239.html#top"><img src="icon_go_up.gif" width="15" height="15" border="0" alt="Go to Top of Page" title="Go to Top of Page" align="right" /></a></td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td bgcolor="whitesmoke" valign="top" width="100" nowrap>
                <p><font face="Verdana, Arial, Helvetica" size="2"><b><span class="spnMessageText">Tumanov</span></b></font><br />
                </p>
                <p>
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>Russia</small></font><br />
                <font color="midnightblue" face="Verdana, Arial, Helvetica" size="1"><small>1198 Posts</small></font></p></td>
                <td bgcolor="whitesmoke" height="100%" width="100%" colspan="2" valign="top"><a name="4169"></a>
                  <table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td valign="top">
                      <img src="icon_posticon.gif" width="15" height="15" border="0" alt="" title="" hspace="3" /><font color="midnightblue" face="Verdana, Arial, Helvetica" size="1">Posted&nbsp;-&nbsp;03/26/2009&nbsp;:&nbsp; 15:50:59</font>
                      <hr noshade size="1"></td>
                    </tr>
                    <tr>
                      <td valign="top" height="100%"><font face="Verdana, Arial, Helvetica" size="2" color="midnightblue"><span class="spnMessageText" id="msg"> Наверно можно было бы попробовать опрашивать сплошняком по индексам. Проверять, есть ли еще строки в секции, есть ли такая секция и т.д.<br />Только универсально все равно не получится. Если ячейки ссылаются друг на друга, то будет важен порядок копирования. В другом порядке формула может не прописаться.</span></font></td>
                    </tr>
                    <tr>
                      <td valign="bottom" align="right" height="20"><a href="topic.asp@TOPIC_ID=2239.html#top"><img src="icon_go_up.gif" width="15" height="15" border="0" alt="Go to Top of Page" title="Go to Top of Page" align="right" /></a></td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td align="center" bgcolor="midnightblue" width="100" nowrap><b><font face="Verdana, Arial, Helvetica" size="2" color="mintcream">&nbsp;</font></b></td>
                <td align="center" bgcolor="midnightblue" width="100"><b><font face="Verdana, Arial, Helvetica" size="2" color="mintcream">
                <a href="topic.asp@TOPIC_ID=2248.html"><img src="icon_go_left.gif" width="15" height="15" border="0" alt="Previous Topic" title="Previous Topic" align="top" hspace="6" /></a><b><font face="Verdana, Arial, Helvetica" size="2" color="mintcream">&nbsp;Topic&nbsp;</font></b><a href="topic.asp@TOPIC_ID=2233.html"><img src="icon_go_right.gif" width="15" height="15" border="0" alt="Next Topic" title="Next Topic" align="top" hspace="6" /></a></font></b></td>
                <td align="right" bgcolor="midnightblue" nowrap><font face="Verdana, Arial, Helvetica" size="2">&nbsp;</font></td>
              </tr>
            </table>
          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table align="center" border="0" cellPadding="0" cellSpacing="0" width="95%">
  <tr>
    <td>
      <table width="100%">
        <tr>
          <td align="center" bgcolor="#ffffAA"><font face="Verdana, Arial, Helvetica" size="2">Данный сайт является архивом форума visio.artberg.ru, который был закрыт в связи с переходом на новую платформу <b><a href="http://visio.getbb.ru">visio.getbb.ru</a></b><br/>Все материалы доступны только для чтения! Если у вас появились вопросы, или вы хотите что-то обсудить, связанное с Visio, обращайтесь на новый форум!<br/>Архив был создан благодаря совместным усилиям Генадия Туманова @Tumanov (<a href="http://visio.artberg.ru">visio.artberg.ru</a>), Александра ака @Surrogate (<a href="http://visio.getbb.ru">visio.getbb.ru</a>), и Николая Белых @nbelyh (<a href="http://unmanagedvisio.com">unmanagedvisio.com</a>)</font></td>
        </tr>
      </table>
  </td>
 </tr>
</table>
</body>
</html>
